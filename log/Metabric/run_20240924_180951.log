2024-09-24 18:09:51,729 - INFO - Using device: cuda
2024-09-24 18:09:51,729 - INFO - Stage 1: Loading data...
2024-09-24 18:10:09,363 - INFO - Number of classes: 5
2024-09-24 18:10:09,363 - INFO - Stage 2: Initializing models...
2024-09-24 18:10:09,395 - INFO - Configuration Parameters:
2024-09-24 18:10:09,395 - INFO - seed: 42
2024-09-24 18:10:09,395 - INFO - batchsize: 128
2024-09-24 18:10:09,396 - INFO - sample_size: 1000
2024-09-24 18:10:09,396 - INFO - lambda_noise: 0.5
2024-09-24 18:10:09,396 - INFO - variance_threshold: 0.85
2024-09-24 18:10:09,396 - INFO - output_dim: 64
2024-09-24 18:10:09,396 - INFO - project_dim: 128
2024-09-24 18:10:09,396 - INFO - mlp_hidden_dim: 64
2024-09-24 18:10:09,396 - INFO - learning_rate: 0.0001
2024-09-24 18:10:09,396 - INFO - weight_decay: 0.001
2024-09-24 18:10:09,396 - INFO - num_epochs: 5000
2024-09-24 18:10:09,396 - INFO - loss_lambda_param: 0.005
2024-09-24 18:10:09,396 - INFO - scaling_method: minmax
2024-09-24 18:10:09,396 - INFO - model_save_path: ./model_checkpoints
2024-09-24 18:10:09,396 - INFO - fra_save_path: ./fra_pre
2024-09-24 18:10:09,396 - INFO - training_dataset_name: All
2024-09-24 18:10:09,396 - INFO - testing_dataset_name: Metabric
2024-09-24 18:10:09,396 - INFO - device: cuda
2024-09-24 18:10:09,396 - INFO - sc_path: ./cancer_single_cell_data/processed_data.h5ad
2024-09-24 18:10:09,396 - INFO - bulk_path: ./cancer_brca_metabric_bulk_data/data_mrna_illumina_microarray_zscores_ref_diploid_samples.txt
2024-09-24 18:10:09,396 - INFO - patient_path: ./cancer_brca_metabric_bulk_data/Tumor_Stage.txt
2024-09-24 18:10:09,396 - INFO - Model Architectures:
2024-09-24 18:10:09,396 - INFO - Encoder: Encoder(
  (layers): Sequential(
    (0): Linear(in_features=1230, out_features=2048, bias=True)
    (1): BatchNorm1d(2048, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): ReLU()
    (3): Dropout(p=0.2, inplace=False)
    (4): Linear(in_features=2048, out_features=1024, bias=True)
    (5): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (6): ReLU()
    (7): Dropout(p=0.2, inplace=False)
    (8): Linear(in_features=1024, out_features=512, bias=True)
    (9): BatchNorm1d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (10): ReLU()
    (11): Dropout(p=0.2, inplace=False)
    (12): Linear(in_features=512, out_features=256, bias=True)
    (13): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (14): ReLU()
    (15): Dropout(p=0.2, inplace=False)
    (16): Linear(in_features=256, out_features=64, bias=True)
  )
)
2024-09-24 18:10:09,396 - INFO - Projector: Projector(
  (layers): Sequential(
    (0): Linear(in_features=64, out_features=512, bias=True)
    (1): BatchNorm1d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): ReLU()
    (3): Linear(in_features=512, out_features=128, bias=True)
  )
)
2024-09-24 18:10:09,396 - INFO - MLP Bulk: MLPClassifier(
  (layers): Sequential(
    (0): Linear(in_features=1230, out_features=64, bias=True)
    (1): ReLU()
    (2): Linear(in_features=64, out_features=64, bias=True)
    (3): ReLU()
    (4): Linear(in_features=64, out_features=5, bias=True)
  )
)
2024-09-24 18:10:09,396 - INFO - MLP Embedded: MLPClassifier(
  (layers): Sequential(
    (0): Linear(in_features=64, out_features=64, bias=True)
    (1): ReLU()
    (2): Linear(in_features=64, out_features=64, bias=True)
    (3): ReLU()
    (4): Linear(in_features=64, out_features=5, bias=True)
  )
)
2024-09-24 18:10:09,396 - INFO - Stage 3: Training Barlow Twins...
2024-09-24 18:10:37,297 - INFO - Epoch 100 completed. Loss: 3.8039
2024-09-24 18:11:04,332 - INFO - Epoch 200 completed. Loss: 2.8291
2024-09-24 18:11:32,537 - INFO - Epoch 300 completed. Loss: 2.3731
2024-09-24 18:12:00,228 - INFO - Epoch 400 completed. Loss: 2.1077
2024-09-24 18:12:25,132 - INFO - Epoch 500 completed. Loss: 1.9127
2024-09-24 18:12:49,741 - INFO - Epoch 600 completed. Loss: 1.7061
2024-09-24 18:13:16,708 - INFO - Epoch 700 completed. Loss: 1.5558
2024-09-24 18:13:44,825 - INFO - Epoch 800 completed. Loss: 1.4278
2024-09-24 18:14:12,367 - INFO - Epoch 900 completed. Loss: 1.3164
2024-09-24 18:14:38,283 - INFO - Epoch 1000 completed. Loss: 1.1656
2024-09-24 18:15:04,328 - INFO - Epoch 1100 completed. Loss: 1.0637
2024-09-24 18:15:29,170 - INFO - Epoch 1200 completed. Loss: 1.0479
2024-09-24 18:15:54,404 - INFO - Epoch 1300 completed. Loss: 1.0263
2024-09-24 18:16:22,918 - INFO - Epoch 1400 completed. Loss: 0.9889
2024-09-24 18:16:50,446 - INFO - Epoch 1500 completed. Loss: 0.9534
2024-09-24 18:17:15,730 - INFO - Epoch 1600 completed. Loss: 0.9473
2024-09-24 18:17:43,127 - INFO - Epoch 1700 completed. Loss: 0.9354
2024-09-24 18:18:10,907 - INFO - Epoch 1800 completed. Loss: 0.9312
2024-09-24 18:18:36,827 - INFO - Epoch 1900 completed. Loss: 0.8929
2024-09-24 18:19:00,466 - INFO - Epoch 2000 completed. Loss: 0.8577
2024-09-24 18:19:27,255 - INFO - Epoch 2100 completed. Loss: 0.8722
2024-09-24 18:19:55,412 - INFO - Epoch 2200 completed. Loss: 0.8773
2024-09-24 18:20:23,352 - INFO - Epoch 2300 completed. Loss: 0.8521
2024-09-24 18:20:51,100 - INFO - Epoch 2400 completed. Loss: 0.8801
2024-09-24 18:21:19,286 - INFO - Epoch 2500 completed. Loss: 0.8273
2024-09-24 18:21:44,198 - INFO - Epoch 2600 completed. Loss: 0.8379
2024-09-24 18:22:10,624 - INFO - Epoch 2700 completed. Loss: 0.7743
2024-09-24 18:22:37,095 - INFO - Epoch 2800 completed. Loss: 0.8192
2024-09-24 18:23:05,552 - INFO - Epoch 2900 completed. Loss: 0.7731
2024-09-24 18:23:33,952 - INFO - Epoch 3000 completed. Loss: 0.7730
2024-09-24 18:24:01,472 - INFO - Epoch 3100 completed. Loss: 0.7875
2024-09-24 18:24:28,874 - INFO - Epoch 3200 completed. Loss: 0.7675
2024-09-24 18:24:57,132 - INFO - Epoch 3300 completed. Loss: 0.7850
2024-09-24 18:25:25,107 - INFO - Epoch 3400 completed. Loss: 0.7798
2024-09-24 18:25:53,473 - INFO - Epoch 3500 completed. Loss: 0.7797
2024-09-24 18:26:21,153 - INFO - Epoch 3600 completed. Loss: 0.7625
2024-09-24 18:26:49,112 - INFO - Epoch 3700 completed. Loss: 0.8048
2024-09-24 18:27:17,533 - INFO - Epoch 3800 completed. Loss: 0.7888
2024-09-24 18:27:44,988 - INFO - Epoch 3900 completed. Loss: 0.7546
2024-09-24 18:28:09,172 - INFO - Epoch 4000 completed. Loss: 0.7861
2024-09-24 18:28:37,803 - INFO - Epoch 4100 completed. Loss: 0.7575
2024-09-24 18:29:05,772 - INFO - Epoch 4200 completed. Loss: 0.7899
2024-09-24 18:29:32,110 - INFO - Epoch 4300 completed. Loss: 0.7842
2024-09-24 18:29:56,281 - INFO - Epoch 4400 completed. Loss: 0.7510
2024-09-24 18:30:18,071 - INFO - Epoch 4500 completed. Loss: 0.7557
2024-09-24 18:30:40,367 - INFO - Epoch 4600 completed. Loss: 0.7646
2024-09-24 18:31:04,468 - INFO - Epoch 4700 completed. Loss: 0.7187
2024-09-24 18:31:32,525 - INFO - Epoch 4800 completed. Loss: 0.7812
2024-09-24 18:32:00,222 - INFO - Epoch 4900 completed. Loss: 0.7431
2024-09-24 18:32:27,240 - INFO - Epoch 5000 completed. Loss: 0.7463
2024-09-24 18:32:27,240 - INFO - Stage 4: Preparing data for classification...
2024-09-24 18:32:27,242 - INFO - Stage 5: Generating Barlow Twins embeddings...
2024-09-24 18:32:27,256 - INFO - Bulk tensor saved to result/Metabric_20240924_180951/bulk_tensor.pt
2024-09-24 18:32:27,256 - INFO - Embeddings saved to result/Metabric_20240924_180951/embedding.pt
2024-09-24 18:32:27,256 - INFO - Stage 6: Preparing MLP classifier...
2024-09-24 18:32:27,292 - INFO - Stage 7: Training and evaluating MLP on original bulk data...
2024-09-24 18:32:27,292 - INFO - Training MLP on original bulk data:
2024-09-24 18:32:28,423 - INFO - Epoch [10/100], Average Loss: 0.7919
2024-09-24 18:32:29,774 - INFO - Epoch [20/100], Average Loss: 0.4809
2024-09-24 18:32:31,122 - INFO - Epoch [30/100], Average Loss: 0.2053
2024-09-24 18:32:32,438 - INFO - Epoch [40/100], Average Loss: 0.0778
2024-09-24 18:32:33,734 - INFO - Epoch [50/100], Average Loss: 0.0366
2024-09-24 18:32:35,077 - INFO - Epoch [60/100], Average Loss: 0.0187
2024-09-24 18:32:36,419 - INFO - Epoch [70/100], Average Loss: 0.0097
2024-09-24 18:32:37,746 - INFO - Epoch [80/100], Average Loss: 0.0055
2024-09-24 18:32:39,020 - INFO - Epoch [90/100], Average Loss: 0.0034
2024-09-24 18:32:40,359 - INFO - Epoch [100/100], Average Loss: 0.0022
2024-09-24 18:32:40,362 - INFO - Evaluating MLP on original bulk data:
2024-09-24 18:32:40,371 - INFO - Confusion Matrix:
2024-09-24 18:32:40,372 - INFO - 
[[  0   1   1   0   0]
 [  0  45  60   5   0]
 [  0  33 114   3   0]
 [  0   7  20   2   0]
 [  0   0   3   0   0]]
2024-09-24 18:32:40,372 - INFO - 
Classification Report:
2024-09-24 18:32:40,372 - INFO - 
              precision    recall  f1-score   support

           0       0.00      0.00      0.00         2
           1       0.52      0.41      0.46       110
           2       0.58      0.76      0.66       150
           3       0.20      0.07      0.10        29
           4       0.00      0.00      0.00         3

    accuracy                           0.55       294
   macro avg       0.26      0.25      0.24       294
weighted avg       0.51      0.55      0.52       294

2024-09-24 18:32:40,372 - INFO - Stage 8: Training and evaluating MLP on Barlow Twins embeddings...
2024-09-24 18:32:41,661 - INFO - Epoch [10/100], Average Loss: 0.9638
2024-09-24 18:32:42,960 - INFO - Epoch [20/100], Average Loss: 0.9066
2024-09-24 18:32:44,226 - INFO - Epoch [30/100], Average Loss: 0.8936
2024-09-24 18:32:45,528 - INFO - Epoch [40/100], Average Loss: 0.8856
2024-09-24 18:32:46,829 - INFO - Epoch [50/100], Average Loss: 0.8788
2024-09-24 18:32:48,125 - INFO - Epoch [60/100], Average Loss: 0.8726
2024-09-24 18:32:49,427 - INFO - Epoch [70/100], Average Loss: 0.8667
2024-09-24 18:32:50,710 - INFO - Epoch [80/100], Average Loss: 0.8611
2024-09-24 18:32:51,969 - INFO - Epoch [90/100], Average Loss: 0.8557
2024-09-24 18:32:53,251 - INFO - Epoch [100/100], Average Loss: 0.8506
2024-09-24 18:32:53,251 - INFO - Evaluating MLP on Barlow Twins embeddings:
2024-09-24 18:32:53,261 - INFO - Confusion Matrix:
2024-09-24 18:32:53,261 - INFO - 
[[  0   1   1   0   0]
 [  0  31  79   0   0]
 [  0  23 127   0   0]
 [  0   4  25   0   0]
 [  0   0   3   0   0]]
2024-09-24 18:32:53,261 - INFO - 
Classification Report:
2024-09-24 18:32:53,261 - INFO - 
              precision    recall  f1-score   support

           0       0.00      0.00      0.00         2
           1       0.53      0.28      0.37       110
           2       0.54      0.85      0.66       150
           3       0.00      0.00      0.00        29
           4       0.00      0.00      0.00         3

    accuracy                           0.54       294
   macro avg       0.21      0.23      0.21       294
weighted avg       0.47      0.54      0.47       294

2024-09-24 18:32:53,262 - INFO - All stages completed.
