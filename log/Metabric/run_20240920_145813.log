2024-09-20 14:58:13,910 - INFO - Using device: cuda
2024-09-20 14:58:13,910 - INFO - Stage 1: Loading data...
2024-09-20 14:58:46,408 - INFO - Number of classes: 5
2024-09-20 14:58:46,409 - INFO - Stage 2: Initializing models...
2024-09-20 14:58:46,654 - INFO - Configuration Parameters:
2024-09-20 14:58:46,654 - INFO - seed: 42
2024-09-20 14:58:46,654 - INFO - batchsize: 128
2024-09-20 14:58:46,654 - INFO - output_dim: 64
2024-09-20 14:58:46,654 - INFO - project_dim: 128
2024-09-20 14:58:46,654 - INFO - mlp_hidden_dim: 64
2024-09-20 14:58:46,654 - INFO - learning_rate: 0.0001
2024-09-20 14:58:46,654 - INFO - weight_decay: 0.001
2024-09-20 14:58:46,654 - INFO - num_epochs: 5000
2024-09-20 14:58:46,654 - INFO - loss_lambda_param: 0.005
2024-09-20 14:58:46,654 - INFO - minmax_icon: True
2024-09-20 14:58:46,654 - INFO - standard_icon: False
2024-09-20 14:58:46,654 - INFO - model_save_path: ./model_checkpoints
2024-09-20 14:58:46,654 - INFO - fra_save_path: ./fra_pre
2024-09-20 14:58:46,655 - INFO - training_dataset_name: All
2024-09-20 14:58:46,655 - INFO - testing_dataset_name: Metabric
2024-09-20 14:58:46,655 - INFO - device: cuda
2024-09-20 14:58:46,655 - INFO - sc_path: ../cancer_data/92_sc_healthy.h5ad
2024-09-20 14:58:46,655 - INFO - bulk_path: ../brca_metabric/data_mrna_illumina_microarray_zscores_ref_diploid_samples.txt
2024-09-20 14:58:46,655 - INFO - patient_path: ../brca_metabric/Tumor_Stage.txt
2024-09-20 14:58:46,655 - INFO - Model Architectures:
2024-09-20 14:58:46,655 - INFO - Encoder: Encoder(
  (layers): Sequential(
    (0): Linear(in_features=18661, out_features=2048, bias=True)
    (1): BatchNorm1d(2048, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): ReLU()
    (3): Dropout(p=0.2, inplace=False)
    (4): Linear(in_features=2048, out_features=1024, bias=True)
    (5): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (6): ReLU()
    (7): Dropout(p=0.2, inplace=False)
    (8): Linear(in_features=1024, out_features=512, bias=True)
    (9): BatchNorm1d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (10): ReLU()
    (11): Dropout(p=0.2, inplace=False)
    (12): Linear(in_features=512, out_features=256, bias=True)
    (13): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (14): ReLU()
    (15): Dropout(p=0.2, inplace=False)
    (16): Linear(in_features=256, out_features=64, bias=True)
  )
)
2024-09-20 14:58:46,655 - INFO - Projector: Projector(
  (layers): Sequential(
    (0): Linear(in_features=64, out_features=512, bias=True)
    (1): BatchNorm1d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): ReLU()
    (3): Linear(in_features=512, out_features=128, bias=True)
  )
)
2024-09-20 14:58:46,655 - INFO - MLP Bulk: MLPClassifier(
  (layers): Sequential(
    (0): Linear(in_features=18661, out_features=64, bias=True)
    (1): ReLU()
    (2): Linear(in_features=64, out_features=64, bias=True)
    (3): ReLU()
    (4): Linear(in_features=64, out_features=5, bias=True)
  )
)
2024-09-20 14:58:46,655 - INFO - MLP Embedded: MLPClassifier(
  (layers): Sequential(
    (0): Linear(in_features=64, out_features=64, bias=True)
    (1): ReLU()
    (2): Linear(in_features=64, out_features=64, bias=True)
    (3): ReLU()
    (4): Linear(in_features=64, out_features=5, bias=True)
  )
)
2024-09-20 14:58:46,655 - INFO - Stage 3: Training Barlow Twins...
2024-09-20 14:59:51,360 - INFO - Epoch 100 completed. Loss: 3.9361
2024-09-20 15:00:53,675 - INFO - Epoch 200 completed. Loss: 2.8990
2024-09-20 15:01:54,479 - INFO - Epoch 300 completed. Loss: 2.4176
2024-09-20 15:02:59,295 - INFO - Epoch 400 completed. Loss: 2.1111
2024-09-20 15:04:00,034 - INFO - Epoch 500 completed. Loss: 1.9459
2024-09-20 15:05:03,199 - INFO - Epoch 600 completed. Loss: 1.7674
2024-09-20 15:06:07,479 - INFO - Epoch 700 completed. Loss: 1.6346
2024-09-20 15:07:13,243 - INFO - Epoch 800 completed. Loss: 1.5293
2024-09-20 15:08:15,424 - INFO - Epoch 900 completed. Loss: 1.4215
2024-09-20 15:09:15,753 - INFO - Epoch 1000 completed. Loss: 1.3150
2024-09-20 15:10:16,820 - INFO - Epoch 1100 completed. Loss: 1.2810
2024-09-20 15:11:17,143 - INFO - Epoch 1200 completed. Loss: 1.2096
2024-09-20 15:12:19,955 - INFO - Epoch 1300 completed. Loss: 1.1361
2024-09-20 15:13:22,046 - INFO - Epoch 1400 completed. Loss: 1.0942
2024-09-20 15:14:28,435 - INFO - Epoch 1500 completed. Loss: 1.0551
2024-09-20 15:15:34,763 - INFO - Epoch 1600 completed. Loss: 1.0731
2024-09-20 15:16:38,820 - INFO - Epoch 1700 completed. Loss: 1.0202
2024-09-20 15:17:40,053 - INFO - Epoch 1800 completed. Loss: 1.0243
2024-09-20 15:18:40,464 - INFO - Epoch 1900 completed. Loss: 1.0259
2024-09-20 15:19:44,187 - INFO - Epoch 2000 completed. Loss: 0.9879
2024-09-20 15:20:49,356 - INFO - Epoch 2100 completed. Loss: 0.9192
2024-09-20 15:21:55,182 - INFO - Epoch 2200 completed. Loss: 0.9810
2024-09-20 15:23:01,176 - INFO - Epoch 2300 completed. Loss: 0.9724
2024-09-20 15:24:06,468 - INFO - Epoch 2400 completed. Loss: 0.9813
2024-09-20 15:25:09,566 - INFO - Epoch 2500 completed. Loss: 0.9063
2024-09-20 15:26:13,654 - INFO - Epoch 2600 completed. Loss: 0.9892
2024-09-20 15:27:16,008 - INFO - Epoch 2700 completed. Loss: 0.8906
2024-09-20 15:28:21,587 - INFO - Epoch 2800 completed. Loss: 0.9503
2024-09-20 15:29:26,209 - INFO - Epoch 2900 completed. Loss: 0.8947
2024-09-20 15:30:32,466 - INFO - Epoch 3000 completed. Loss: 0.8908
2024-09-20 15:31:34,774 - INFO - Epoch 3100 completed. Loss: 0.9206
2024-09-20 15:32:34,615 - INFO - Epoch 3200 completed. Loss: 0.8951
2024-09-20 15:33:39,336 - INFO - Epoch 3300 completed. Loss: 0.8828
2024-09-20 15:34:43,379 - INFO - Epoch 3400 completed. Loss: 0.9494
2024-09-20 15:35:47,152 - INFO - Epoch 3500 completed. Loss: 0.9055
2024-09-20 15:36:50,587 - INFO - Epoch 3600 completed. Loss: 0.9260
2024-09-20 15:37:53,263 - INFO - Epoch 3700 completed. Loss: 0.9504
2024-09-20 15:38:56,362 - INFO - Epoch 3800 completed. Loss: 0.9095
2024-09-20 15:39:59,947 - INFO - Epoch 3900 completed. Loss: 0.8720
2024-09-20 15:41:05,497 - INFO - Epoch 4000 completed. Loss: 0.8726
2024-09-20 15:42:07,336 - INFO - Epoch 4100 completed. Loss: 0.8941
2024-09-20 15:43:08,669 - INFO - Epoch 4200 completed. Loss: 0.8703
2024-09-20 15:44:14,147 - INFO - Epoch 4300 completed. Loss: 0.8602
2024-09-20 15:45:18,956 - INFO - Epoch 4400 completed. Loss: 0.8893
2024-09-20 15:46:25,194 - INFO - Epoch 4500 completed. Loss: 0.8735
2024-09-20 15:47:30,816 - INFO - Epoch 4600 completed. Loss: 0.8820
2024-09-20 15:48:36,607 - INFO - Epoch 4700 completed. Loss: 0.8909
2024-09-20 15:49:41,507 - INFO - Epoch 4800 completed. Loss: 0.8684
2024-09-20 15:50:46,929 - INFO - Epoch 4900 completed. Loss: 0.8836
2024-09-20 15:51:50,636 - INFO - Epoch 5000 completed. Loss: 0.8785
2024-09-20 16:27:47,292 - INFO - Stage 4: Preparing data for classification...
2024-09-20 16:27:47,339 - INFO - Stage 5: Generating Barlow Twins embeddings...
2024-09-20 16:27:47,348 - INFO - Embeddings saved to embedding/Metabric/embedding_20240920_145813.pt
2024-09-20 16:27:47,348 - INFO - Stage 6: Preparing MLP classifier...
2024-09-20 16:27:47,743 - INFO - Stage 7: Training and evaluating MLP on original bulk data...
2024-09-20 16:27:47,743 - INFO - Training MLP on original bulk data:
2024-09-20 16:27:48,837 - INFO - Epoch [10/100], Average Loss: 0.0621
2024-09-20 16:27:49,912 - INFO - Epoch [20/100], Average Loss: 0.0082
2024-09-20 16:27:51,246 - INFO - Epoch [30/100], Average Loss: 0.0029
2024-09-20 16:27:52,395 - INFO - Epoch [40/100], Average Loss: 0.0014
2024-09-20 16:27:53,390 - INFO - Epoch [50/100], Average Loss: 0.0008
2024-09-20 16:27:54,588 - INFO - Epoch [60/100], Average Loss: 0.0005
2024-09-20 16:27:55,840 - INFO - Epoch [70/100], Average Loss: 0.0003
2024-09-20 16:27:56,823 - INFO - Epoch [80/100], Average Loss: 0.0002
2024-09-20 16:27:58,098 - INFO - Epoch [90/100], Average Loss: 0.0002
2024-09-20 16:27:59,350 - INFO - Epoch [100/100], Average Loss: 0.0001
2024-09-20 16:27:59,350 - INFO - Evaluating MLP on original bulk data:
2024-09-20 16:27:59,362 - INFO - Confusion Matrix:
2024-09-20 16:27:59,362 - INFO - 
[[  0   1   1   0   0]
 [  0  41  65   4   0]
 [  0  23 126   1   0]
 [  0   5  22   2   0]
 [  0   0   3   0   0]]
2024-09-20 16:27:59,363 - INFO - 
Classification Report:
2024-09-20 16:27:59,363 - INFO - 
              precision    recall  f1-score   support

           0       0.00      0.00      0.00         2
           1       0.59      0.37      0.46       110
           2       0.58      0.84      0.69       150
           3       0.29      0.07      0.11        29
           4       0.00      0.00      0.00         3

    accuracy                           0.57       294
   macro avg       0.29      0.26      0.25       294
weighted avg       0.54      0.57      0.53       294

2024-09-20 16:27:59,363 - INFO - Stage 8: Training and evaluating MLP on Barlow Twins embeddings...
2024-09-20 16:28:00,463 - INFO - Epoch [10/100], Average Loss: 1.0061
2024-09-20 16:28:01,746 - INFO - Epoch [20/100], Average Loss: 0.9457
2024-09-20 16:28:03,004 - INFO - Epoch [30/100], Average Loss: 0.9279
2024-09-20 16:28:04,325 - INFO - Epoch [40/100], Average Loss: 0.9188
2024-09-20 16:28:05,572 - INFO - Epoch [50/100], Average Loss: 0.9123
2024-09-20 16:28:06,690 - INFO - Epoch [60/100], Average Loss: 0.9068
2024-09-20 16:28:07,830 - INFO - Epoch [70/100], Average Loss: 0.9018
2024-09-20 16:28:08,935 - INFO - Epoch [80/100], Average Loss: 0.8971
2024-09-20 16:28:10,080 - INFO - Epoch [90/100], Average Loss: 0.8929
2024-09-20 16:28:11,375 - INFO - Epoch [100/100], Average Loss: 0.8887
2024-09-20 16:28:11,375 - INFO - Evaluating MLP on Barlow Twins embeddings:
2024-09-20 16:28:11,384 - INFO - Confusion Matrix:
2024-09-20 16:28:11,385 - INFO - 
[[  0   0   2   0   0]
 [  0  15  95   0   0]
 [  0  12 138   0   0]
 [  0   4  25   0   0]
 [  0   0   3   0   0]]
2024-09-20 16:28:11,385 - INFO - 
Classification Report:
2024-09-20 16:28:11,385 - INFO - 
              precision    recall  f1-score   support

           0       0.00      0.00      0.00         2
           1       0.48      0.14      0.21       110
           2       0.52      0.92      0.67       150
           3       0.00      0.00      0.00        29
           4       0.00      0.00      0.00         3

    accuracy                           0.52       294
   macro avg       0.20      0.21      0.18       294
weighted avg       0.45      0.52      0.42       294

2024-09-20 16:28:11,385 - INFO - All stages completed.
